const config={apiEndpoint:"https://www.itisuniqueofficial.com/feeds/comments/default?alt=json&max-results=1000",initialComments:10,loadMoreCount:5,showAvatar:!0,avatarSize:50,roundAvatar:!0,characters:150,showMoreLink:!0,moreLinkText:"Read More",animationDuration:300,defaultAvatar:"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjit9MCnrMRXaYOqLwqsPIzmWRnN1Hr7rt3NHkgAHI5fTGEpn8PZ-yNGZicjo6_7YeFlWpPR8FQPx5Lyg2Xxtv-HhUEnofyuz4w9MlTrL9Jz86HjlYoPOagfZK_Rr79lYIj9ekYIUfJldvY6N0FmQ49Suf5MciTOlBqRgNKH_-xjUhJvAw/s1600/user.png"};if("undefined"==typeof debounce)var debounce=(e,t)=>{let n;return(...o)=>(clearTimeout(n),n=setTimeout(()=>e.apply(this,o),t))};class CommentsWidget{constructor(){this.allComments=[],this.displayedComments=config.initialComments,this.container=document.getElementById("idbcomments"),this.loader=document.getElementById("comments-loader"),this.loadMoreBtn=document.getElementById("load-more-comments"),this.countElement=document.getElementById("comments-count"),this.isLoadingMore=!1,this.init()}async init(){this.bindEvents(),await this.fetchComments(),this.setupIntersectionObserver()}bindEvents(){this.loadMoreBtn.addEventListener("click",debounce(()=>this.loadMore(),300))}async fetchComments(){this.showLoader(!0);try{const e=await fetch(config.apiEndpoint,{cache:"no-store"});if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();this.allComments=(t.feed.entry||[]).sort((e,t)=>new Date(t.published.$t)-new Date(e.published.$t)),this.renderComments(),this.updateUI()}catch(e){console.error("Failed to load comments:",e),this.showError()}finally{this.showLoader(!1)}}renderComments(){this.container.innerHTML="";const e=document.createDocumentFragment();this.allComments.slice(0,this.displayedComments).forEach((t,n)=>{e.appendChild(this.createCommentElement(t,n))}),this.container.appendChild(e)}createCommentElement(e,t){const n=e.author?.[0]?.name?.$t||"Anonymous",o=this.getAvatarUrl(e.author?.[0]?.gd$image?.src),i=e.link?.find(e=>"alternate"===e.rel)?.href||"#",s=e.content?.$t.replace(/(<([^>]+)>)/gi,"")||"",a=new Date(e.published.$t).toLocaleString(),r=s.length>config.characters?s.substring(0,config.characters)+"â€¦":s,l=config.showMoreLink&&s.length>config.characters?`<a href="${i}" class="more-link">${config.moreLinkText}</a>`:"",c=document.createElement("div");return c.className="comment",c.setAttribute("role","listitem"),c.style.animationDelay=`${.1*t}s`,c.innerHTML=`${config.showAvatar?`<img class="avatar ${config.roundAvatar?"round":""}" src="${o}" alt="Avatar of ${n}" loading="lazy" width="${config.avatarSize}" height="${config.avatarSize}">`:""}<div class="comment-content"><div class="comment-header"><a href="${i}" class="author" rel="nofollow">${n}</a><time class="comment-date" datetime="${e.published.$t}">${a}</time></div><p>${r} ${l}</p></div>`,c}getAvatarUrl(e){return e?e.includes("/s1600/")?e.replace("/s1600/","/s"+config.avatarSize+"-c/"):e.includes("/s220/")?e.replace("/s220/","/s"+config.avatarSize+"-c/"):e.includes("blank.gif")?config.defaultAvatar:e:config.defaultAvatar}setupIntersectionObserver(){const e=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&(t.target.classList.add("animate"),e.unobserve(t.target))})},{threshold:.1});this.container.querySelectorAll(".comment").forEach(t=>e.observe(t))}async loadMore(){this.isLoadingMore||(this.isLoadingMore=!0,this.loadMoreBtn.disabled=!0,this.loadMoreBtn.textContent="Loading...",this.displayedComments+=config.loadMoreCount,this.renderComments(),this.updateUI(),this.isLoadingMore=!1,this.loadMoreBtn.disabled=!1,this.loadMoreBtn.textContent="Load More Comments",this.loadMoreBtn.focus())}updateUI(){this.countElement.textContent=`${Math.min(this.displayedComments,this.allComments.length)} of ${this.allComments.length} comments`,this.loadMoreBtn.classList.toggle("hidden",this.displayedComments>=this.allComments.length)}showLoader(e){this.loader.classList.toggle("hidden",!e)}showError(){this.container.innerHTML='<div class="error-message" role="alert">Failed to load comments.<button id="retry-btn" class="retry-btn">Retry</button></div>',document.getElementById("retry-btn").addEventListener("click",()=>this.fetchComments())}}new CommentsWidget;
